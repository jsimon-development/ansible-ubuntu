---

- name: Check Composer version
  command: "composer --version"
  register: composer_version
  ignore_errors: true

- name: Install Composer
  shell: curl -sS https://getcomposer.org/installer | php && mv -f ./composer.phar /usr/local/bin/composer
  args:
    creates: /usr/local/bin/composer
    warn: false
  when: '"not installed" in composer_version.stdout'

- name: Upgrade Composer
  shell: composer self-update
  ignore_errors: true

- name: Make Composer executable
  file: path=/usr/local/bin/composer mode=0755